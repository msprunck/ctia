(ns ctia.entity.vulnerability.mapping
  (:require [ctia.stores.es.mapping :as em]))

(def cve
  {:properties
   {:cve_data_meta
    {:properties
     {:assigner em/token
      :id em/token}}}})

(def impact
  {:properties
   {:cvss_v2
    {:properties
     {:vector_string em/token
      :base_score em/float-type
      :base_severity em/token
      :access_vector em/token
      :access_complexity em/token
      :authentication em/token
      :confidentiality_impact em/token
      :integrity_impact em/token
      :availability_impact em/token
      :exploitability em/token
      :remediation_level em/token
      :report_confidence em/token
      :temporal_vector_string em/token
      :collateral_damage_potential em/token
      :target_distribution em/token
      :confidentiality_requirement em/token
      :integrity_requirement em/token
      :availability_requirement em/token
      :environmental_vector_string em/token
      :obtain_all_privilege em/boolean-type
      :obtain_user_privilege em/boolean-type
      :obtain_other_privilege em/boolean-type
      :user_interaction_required em/boolean-type
      :exploitability_score em/float-type
      :impact_score em/float-type}}

    :cvss_v3
    {:properties
     {:vector_string em/token
      :attack_vector em/token
      :modified_attack_vector em/token
      :attack_complexity em/token
      :confidentiality_requirement em/token
      :report_confidence em/token
      :modified_attack_complexity em/token
      :privileges_required em/token
      :modified_privileges_required em/token
      :user_interaction em/token
      :modified_user_interaction em/token
      :scope em/token
      :modified_scope em/token
      :availability_requirement em/token
      :confidentiality_impact em/token
      :modified_confidentiality_impact em/token
      :integrity_impact em/token
      :modified_integrity_impact em/token
      :environmental_severity em/token
      :availability_impact em/token
      :modified_availability_impact em/token
      :exploit_code_maturity em/token
      :base_score em/float-type
      :base_severity em/token
      :temporal_score em/float-type
      :environmental_score em/float-type
      :remediation_level em/token
      :temporal_severity em/float-type
      :integrity_requirement em/token
      :exploitability_score em/float-type
      :impact_score em/float-type}}}})

(def vulnerability-mapping
  {"vulnerability"
   {:dynamic false
    :properties
    (merge
     em/base-entity-mapping
     em/describable-entity-mapping
     em/sourcable-entity-mapping
     em/stored-entity-mapping
     {:cve cve
      :impact impact
      :severity em/token
      :published_date em/ts
      :last_modified_date em/ts
      :tlp em/token})}})
